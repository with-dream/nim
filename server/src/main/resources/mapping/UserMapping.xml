<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.server.mapper.UserMapper">
    <insert id="register" parameterType="user.UserModel">
        insert into user(name, pwd, uuid, registerTime) values (#{name}, #{pwd}, #{uuid}, #{registerTime});
    </insert>

    <select id="login" resultMap="user.UserModel" parameterType="user.UserModel">
        SELECT * FROM user_info where name = #{name} and pwd = #{pwd};
    </select>

    <select id="checkUser" resultType="int">
        SELECT count(*) FROM user where uuid = #{uuid};
    </select>

    <select id="checkFriend" resultMap="user.FriendModel">
        SELECT * FROM friend where user_id = #{userId} and friend_id = #{friendId};
    </select>

    <insert id="addFriend" parameterType="user.FriendModel">
        insert into friend(user_id, friend_id, status, user_info, friend_info)
        values(#{userId}, #{friendId}, #{status}, #{userInfo}, #{friendInfo});
    </insert>

    <update id="delFriend" parameterType="user.FriendModel">
        update friend set status=#{status} where user_id = #{userId} and friend_id = #{friendId};
    </update>

    <select id="getAllFriend" resultMap="user.FriendModel" parameterType="java.lang.String">
        SELECT * FROM friend_info where user_id = #{uuid} or friend_id = #{uuid};
    </select>

    <select id="getGroupMembers" resultMap="user.GroupMemberModel" parameterType="long">
        SELECT * FROM group_member where groupId= #{groupId};
    </select>

    <insert id="addGroupMember" parameterType="user.GroupMemberModel">
        insert into group_member(uuid, groupId, role, level, insertTime, lastTime) values(#{uuid}, #{groupId}, #{role}, #{level}, #{insertTime}, #{lastTime});
    </insert>

    <delete id="delGroupMember" parameterType="user.GroupMemberModel">
        delete from group_member where uuid=#{uuid} and groupId=#{id};
    </delete>

    <select id="checkGroupRole" resultMap="int" parameterType="user.GroupMemberModel">
        SELECT role FROM group_member where group_id = #{groupId} and uuid=#{uuid};
    </select>

    <select id="getGroupInfo" resultMap="user.GroupInfoModel" parameterType="long">
        SELECT * FROM group_info where group_id = #{groupId};
    </select>


    <insert id="createGroup" useGeneratedKeys="true" keyProperty="id" parameterType="user.GroupInfoModel">
        insert into group_info(name, uuid, memberCount) values(#{name}, #{uuid}, #{memberCount});
    </insert>

    <delete id="delGroup" parameterType="user.GroupModel">
        delete from group_info where id=#{groupId};
    </delete>

    <insert id="addMapGroup" parameterType="user.GroupMapModel">
        insert into group_map(user_id, group_id) values(#{userId}, #{groupId});
    </insert>

    <delete id="delMapGroup" parameterType="long">
        delete from group_map where user_id=#{userId};
    </delete>

    <select id="getAllGroup" resultMap="user.GroupInfoModel" parameterType="java.lang.String">
        SELECT * FROM group_info where uuid = #{uuid};
    </select>
</mapper>


