<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.server.mapper.UserMapper">
    <insert id="register" parameterType="com.example.server.entity.UserEntity">
        insert into user_info(name, pwd, uuid, registerTime) values (#{name}, #{pwd}, #{uuid}, #{registerTime});
    </insert>

    <select id="login" resultType="com.example.server.entity.UserCheckEntity"
            parameterType="com.example.server.entity.UserEntity">
        SELECT * FROM user_info where name=#{name} and pwd=#{pwd};
    </select>

    <select id="checkUser" resultType="int">
        SELECT count(*) FROM user_info where uuid = #{uuid};
    </select>

    <select id="userInfo" resultType="com.example.server.entity.UserEntity">
        SELECT * FROM user_info where uuid = #{uuid};
    </select>

    <select id="friendList" resultType="com.example.server.entity.FriendInfoEntity" parameterType="java.lang.String">
        SELECT * FROM friend_info where userId = #{uuid} and isBlock = false;
    </select>

    <select id="isFriend" resultType="boolean" parameterType="com.example.server.entity.FriendInfoEntity">
        select isFriend from friend_info where userId = #{userId} and friendId = #{friendId};
    </select>

    <insert id="addFriend" parameterType="com.example.server.entity.FriendInfoEntity">
        insert into friend_info(userId, friendId, isFriend, remark, stick, insertTime)
        values(#{userId}, #{friendId}, #{isFriend}, #{remark}, #{stick}, #{insertTime});
    </insert>

    <update id="delFriend" parameterType="com.example.server.entity.FriendInfoEntity">
        update friend_info set isFriend=false where user_id = #{userId} and friend_id = #{friendId};
    </update>

    <insert id="blockFriend" parameterType="com.example.server.entity.FriendInfoEntity">
        insert into block_info(userId, friendId) value(#{userId}, #{friendId});
    </insert>

    <delete id="delBlockFriend" parameterType="com.example.server.entity.FriendInfoEntity">
        delete from block_info where userId=#{userId} and friendId=#{friendId}
    </delete>

    <insert id="stickFriend" parameterType="com.example.server.entity.FriendInfoEntity">
        insert into stick_info where userId=#{userId} and friendId=#{friendId}
    </insert>

    <delete id="delStickFriend" parameterType="com.example.server.entity.FriendInfoEntity">
        delete from stick_info where userId=#{userId} and friendId=#{friendId}
    </delete>


    <!-- xia -->
    <select id="getGroupMembers" resultType="com.example.server.entity.GroupMemberEntity"
            parameterType="java.lang.String">
        SELECT * FROM group_member where groupId= #{groupId};
    </select>

    <insert id="addGroupMember" parameterType="com.example.server.entity.GroupMemberEntity">
        insert into group_member(uuid, groupId, role, level, insertTime, lastTime) values(#{uuid}, #{groupId}, #{role}, #{level}, #{insertTime}, #{lastTime});
    </insert>

    <delete id="delGroupMember" parameterType="com.example.server.entity.GroupMemberEntity">
        delete from group_member where uuid=#{uuid} and groupId=#{groupId};
    </delete>

    <select id="checkGroupRole" resultType="int" parameterType="com.example.server.entity.GroupMemberEntity">
        SELECT role FROM group_member where group_id = #{groupId} and uuid=#{uuid};
    </select>

    <select id="getGroupInfo" resultType="com.example.server.entity.GroupInfoEntity" parameterType="java.lang.String">
        SELECT * FROM group_info where group_id = #{groupId};
    </select>

    <insert id="createGroup" parameterType="com.example.server.entity.GroupInfoEntity">
        insert into group_info(name, uuid, groupId, memberCount) values(#{name}, #{uuid}, #{groupId}, #{memberCount});
    </insert>

    <delete id="delGroup" parameterType="com.example.server.entity.GroupMemberEntity">
        delete from group_info where groupId=#{groupId};
    </delete>

    <select id="getAllGroup" resultType="com.example.server.entity.GroupInfoEntity" parameterType="java.lang.String">
        SELECT * FROM group_info where uuid = #{uuid};
    </select>
</mapper>


